<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="stylesheet" href="scripts/semantic-ui-css/semantic.min.css">
  <title>SPA Demo</title>
</head>
<body>
  <div class="ui container">
    <!-- Navigation Menu -->
    <div class="ui four item inverted orange menu">
      <div class="header item">
        <i class="money bill alternate outline icon"></i>
        Classifying images in the dark
      </div>
    </div>

    <!-- Application Root -->
    <div id="app"></div>
    <span style="font-size:160%;">Chose a file and it shall be classified.</span><br>
    <input type="file" onchange="handleFileLoad()"><br>
    <img src="" height="400" alt="Image preview...">
    <div>
      <button type="button" id="classifyBtn" onclick="classifyAgain()">Classify again</button>
      <span style="font-size:160%;">Category: <span id="resultField"></span></span>
    </div>

    <br><br>
    <span style="font-size:160%;">Change inference model:</span><br>
    <select name="models" id="models">
      <option value="svm">svm</option>
      <option value="svm2">svm2(placeholder)</option>
      <option value="dnn">dnn(placeholder)</option>
    </select>
    <button type="button" onclick="changeModel()">Change!</button>
  </div>
  <script>
      const preview = document.querySelector('img');
      const resultField = document.getElementById('resultField');
      const classifyBtn = document.getElementById('classifyBtn');
      preview.style.visibility = "hidden";
      classifyBtn.style.display = "none";
      function classifyAgain(){
        sendImage(preview.src)
      }
      function handleFileLoad() {
        const file = document.querySelector('input[type=file]').files[0];
        const reader = new FileReader();
        resultField.innerHTML = "";
        reader.addEventListener("load", function () {
            // convert image file to base64 string
            preview.style.visibility = "visible";
            classifyBtn.style.display = "inline";
            preview.src = reader.result;
            sendImage(reader.result);
        }, false);

        if (file) {
            reader.readAsDataURL(file);
        }
        }
      const sendImage = async (image) => {
        resultField.innerHTML = "";
        const response = await fetch('http://localhost:3001/', {
        method: 'POST',
        body: image, // string or object
        headers: {
            'Content-Type': 'application/json'
            }
        }).catch(function(error) {
            resultField.innerHTML = "<p style='color:red'>backend might be down</p>";
            console.log(error);
        });
        const myJson = await response.json(); //extract JSON from the http response
          resultField.innerHTML = myJson.result;
        }
        const changeModel = async (image) => {
          const modelsDropdown = document.getElementById('models');
          const response = await fetch('http://localhost:3001/changemodel', {
            method: 'POST',
            body: modelsDropdown.options[modelsDropdown.selectedIndex].value, // string or object
            headers: {
                'Content-Type': 'application/json'
                }
            });
            const myJson = await response.json(); //extract JSON from the http response
              // resultField.innerHTML = myJson.result;
        }

  </script>
  <!-- JS Library Dependencies -->
  <script src="scripts/jquery/dist/jquery.min.js"></script>
  <script src="scripts/semantic-ui-css/semantic.min.js"></script>
  <script src="scripts/axios/dist/axios.min.js"></script>
  <script src="scripts/handlebars/dist/handlebars.min.js"></script>
  <script src="scripts/vanilla-router/dist/vanilla-router.min.js"></script>
  <script src="js/app.js"></script>
</body>
</html>